{% extends "home/social_base.html" %}

{% load static %}

{% block content %}
<meta name="viewport" content="width=device-width , initial-scale=1" />

<style>
    .btn-grad {
     background-image: linear-gradient(to right, #314755 0%, #26a0da 51%, #314755 100%);
     width: 120px;
     height: 50px;
     padding: 10px;
     margin-bottom: auto;
     margin-top: auto;
     font-weight: 500;
     cursor: pointer;
     border: none;
     text-align: center;
     transition: 0.5s;
     background-size: 200% auto;
     color: white;
     box-shadow: 0 0 20px #eee;
     border-radius: 10px;
     display: block;
}
 .btn-grad:hover {
     background-position: right center;
     color: #fff;
     text-decoration: none;
}
 .btn-participate {
     display: none;
     background-image: linear-gradient(to right, #314755 0%, #26a0da 51%, #314755 100%);
     margin-top: 30px;
     margin-top: auto;
     margin-bottom: auto;
     width: 80%;
     height: 50px;
     padding: 10px;
     font-weight: 500;
     cursor: pointer;
     border: none;
     text-align: center;
     transition: 0.5s;
     background-size: 200% auto;
     color: white;
     box-shadow: 0 0 20px #eee;
     border-radius: 10px;
}
 .btn-participate:hover {
     background-position: right center;
     color: #fff;
     text-decoration: none;
}
 .abc {
     display: none;
}
 ul li:hover {
     background-color: #E1E5EA;
     transform: scale(1.1);
}
 #icon {
     height: 24px;
}
 .ulist {
    display: flex;
    justify-content: safe space-around;
    align-items: center;
    padding: 0 1rem;
    height: 110px;
    background: white;
    box-shadow: 0 0 7px 2px #d1d1d1;
    margin: 0 auto;
    border-radius: 15px;
    overflow-y: hidden;
    overflow-x: auto;
}
 .t1 {
     margin: auto;
 }
 .list {
     cursor: pointer;
     padding: 28px 11px 18px 11px;
     text-align: center;
     width: 110px;
     display: block;
}
 .overview {
     margin-left: 40px;
     display: block;
}
 .activees {
     background-color: #14279B;
     color: white;
}
 .tabss {
     margin-top: 0px;
     padding-top: 0px;
}
 .compdiv{
    padding: 3rem; 
    display: block;
    box-shadow: 0 0 0px 2px #d1d1d1;
    background: white;
    margin:0 auto 1rem auto;
    border-radius: 15px ;
 }
 .drag-area {
     text-align: center;
     border: 2px dashed #4facfe;
     height: 500px;
     width: 100%;
     border-radius: 5px;
     display: flex;
     align-items: center;
     justify-content: center;
     flex-direction: column;
}
 .drag-area.active {
     border: 2px solid #4facfe;
}
 .drag-area .icon {
     font-size: 100px;
     color: #4facfe;
}
 .drag-area header {
     font-size: 30px;
     font-weight: 500;
     color: #4facfe;
}
 .drag-area span {
     font-size: 25px;
     font-weight: 500;
     color: #4facfe;
     margin: 10px 0 15px 0;
}
 .drag-button {
     padding: 1% 3%;
     font-size: 20px;
     font-weight: 300;
     border: none;
     outline: none;
     background:#4facfe;
     color: white;
     border-radius: 5px;
     cursor: pointer;
}
 .drag-area img {
     height: 100%;
     width: 100%;
     object-fit: cover;
     border-radius: 5px;
}
 .progress {
     margin: 20px auto;
     padding: 0;
     width: 90%;
     height: 30px;
     overflow: hidden;
     background: #e5e5e5;
     border-radius: 6px;
}
 .bar {
     position: relative;
     float: left;
     min-width: 1%;
     height: 100%;
     background-image: -webkit-linear-gradient(#06F, #0CF);
     background-image: linear-gradient(#06F, #0CF);
}
 .percent {
     position: absolute;
     top: 50%;
     left: 50%;
     transform: translate(-50%, -50%);
     margin: 0;
     font-family: tahoma, arial, helvetica;
     font-size: 12px;
     color: white;
}
 .plist {
     height: 140px;
     background: white;
     box-shadow: 0 0 7px 2px #d1d1d1;
     display: flex;
     margin: 0 auto;
     justify-content: center;
     align-items: center;
     border-radius: 15px;
}
 .date {
     padding: 28px 11px 18px 11px;
     text-align: center;
     width: 110px;
     display: block;
}
 #start {
     height: 20px;
}
 .above {
     display: block;
     width: 75%;
     margin-top: 2%;
}
 .label1 {
     text-align: center;
     font-weight: bold;
     display: block;
}
.limiter{
    width:90%;
    max-width: 60rem; 
}
/* Table Stylings */
 .sub-table-wrapper{
     position: relative;
     width: 100%;
     margin-bottom: 0.2rem;
     border-radius: 0.2rem;
     overflow: auto;
     background:#ffffffaa;
     box-shadow: var(--shadow-xs);
}
 .sub-table{
     width: 100%;
     height: auto;
     text-align: center;
     border-collapse: collapse;
     padding: 0.5rem;
}
 .sub-th{
     position: sticky;
     top: 0;
     background-color: var(--color-primary-dark);
     color: var(--color11);
     padding: 1rem;
     z-index: 2;
}
 .sub-tr{
     border-bottom: solid 1px var(--color-grey-dark-2);
}
 .sub-td{
     padding: 1rem;
}
 .sub-td.sub-th{
     background-color: var(--color-primary-light);
     color: var(--color-grey-dark-3);
     padding: 0.4rem;
}
 .sub-th,.sub-td{
     /* max-width: 10rem; */
     width: auto;
     margin: 0.4rem;
     white-space: nowrap;
     overflow: hidden;
     text-overflow: ellipsis;
}
@media (max-width:480px) {
     .drag{
         font-size: 100%;
    }
     .label1 {
         display: none;
    }
     .btn-grad {
         display: none;
    }
     .btn-participate {
         display: block;
    }
     .abc {
         display: block;
    }
     .list {
         padding: 28px 5px 18px 5px;
    }
}
 @media (max-width:767px) {
     .label1 {
         display: none;
    }
     .drag{
         font-size: 100%;
    }
     .btn-grad {
         display: none;
    }
     .btn-participate {
         display: block;
    }
     .abc {
         display: block;
    }
     .compdiv{
         padding: 1.5rem;
     }
}
</style>

<div class="container">
    <div id="stories-feed" class="navbar-v2-wrapper">
        <div class="container is-desktop">
            <div class="stories-wrapper is-home is-full">
                <div class="inner-wrapper">
                    <div class="columns" style="margin: unset; justify-content: center; align-items: center;">
                        <!-- Story -->
                        {% if competion.image %}
                        <div class="limiter" style="display: flex; justify-content: center; margin: 0 auto;">
                            <img src="{{competion.image.url}}" alt="" data-demo-src="{{competion.image.url}}" style="border-radius: 15px;width: 100%;height: 100%;">
                        </div>
                        {% endif %}
                    </div>
                    <br>



                    <!-- <div class="compcontent" style="display: flex;border:1px solid red;">



                            <div style="cursor: pointer;

                            background-color: blue;

                            box-shadow: 0 0 7px 2px #d1d1d1;

                            margin-right: 14px;

                            display:flex;

                            flex-direction:column;

                            align-items:center !important;

                            width:55%;

                            height:350px;

                            padding-top: 10px;

                            color: #6c757d!important;">



                            <a class="anchsame activee" style="padding-top: 55px;color:brown;">OVERVIEW</a>

                            <a class="anchsame" style="padding-top: 27px;color:brown;">CHALLENGE</a>

                            <a class="anchsame" style="padding-top: 27px;color:brown;">RULES</a>

                            <a class="anchsame" style="padding-top: 27px;color:brown;">EVALUATION</a>

                            <a class="anchsame" style="padding-top: 27px;color:brown;">PRIZE</a>



                        </div>



                        <div class="compdiv" style="background-color:white;padding:15px;">



                            <div id="target1"> {{competion.overview | safe}}</div>

                            <div id="target2">{{competion.challenge | safe}}</div>

                            <div id="target3">{{competion.rules | safe}}</div>

                            <div id="target4">{{competion.evaluation | safe}}</div>

                            <div id="target5">{{competion.prize | safe}}</div>



                        </div>



                        </div>



                        -->
                    <!-- PROGRESS BAR START-->
                    <div class="plist limiter">
                        <div class="date">
                            <i class="fas fa-running fa-2x"></i>
                            <div style="margin-bottom: 5%;"></div>

                            <p style="font-weight:300px;">{{competion.start | date:"d M Y"}}</p>
                        </div>

                        <div class="above">
                            <label for="head" class="label1"><span id="days"></span> Days Remaining </label>
                            <!-- <label for="head1" class="label2" ><span id="days"></span> Days <span id="hours"></span> Hours <span id="min"></span> Minutes </label>  -->
                            <div style="padding: 1%;"></div>
                            <div class="progress" style="margin-top: 0%;">

                                <div class="bar" id="progressbar" role="progressbar" aria-valuenow="70"
                                    aria-valuemin="0" aria-valuemax="100" style="width:0%">
                                    <p class="percent" style="font-weight: bold;" id="para"></p>
                                </div>
                            </div>
                        </div>

                        <div class="date">
                            <i class="fas fa-flag-checkered fa-2x" id="icon"></i>
                            <div style="margin-bottom:5%;"></div>
                            <p style="font-weight :300px;;">{{competion.end |date:"d M Y"}}</p>
                        </div>

                    </div><br>
                    <!-- PROGRESS BAR END -->
                    <!-- <div class="progmobile">
                        <div class="plist">
                            <div class="date" style="margin-left: 3%;">
                                <i class="fas fa-running fa-2x"></i>
                                <div style="margin-bottom: 5%;"></div>

                                <p style="font-weight:300px;">{{competion.start | date:"d M Y"}}</p>
                            </div>

                            <div class="above">
                                <label for="head" class="label1"><span id="days"></span> Days Remaining </label>
                                
                                <div style="padding: 1%;"></div>
                                <div class="progress" style="margin-top: 0%;">

                                    <div class="bar" id="progressbar" role="progressbar" aria-valuenow="70"
                                        aria-valuemin="0" aria-valuemax="100" style="width:0%">
                                        <p class="percent" style="font-weight: bold;" id="para"></p>
                                    </div>
                                </div>
                            </div>

                            <div class="date" style="margin-right: 3%;">
                                <i class="fas fa-flag-checkered fa-2x" id="icon"></i>
                                <div style="margin-bottom:5%;"></div>
                                <p style="font-weight :300px;;">{{competion.end |date:"d M Y"}}</p>
                            </div>

                        </div><br>
                    </div> -->

                    <ul class="ulist limiter">
                        <div class="t1">
                            <li data-list="tab_1" class="list">

                                <i class="fas fa-th fa-lg" id="icon"></i>

                                <p>OVERVIEW</p>

                            </li>
                        </div>
                        <div class="t1">
                            <li data-list="tab_2" class="list">

                                <i class="fas fa-hourglass-half fa-lg" id="icon"></i>

                                <p>CHALLENGE</p>



                            </li>
                        </div>
                        <div class="t1">
                            <li data-list="tab_3" class="list">

                                <i class="far fa-list-alt fa-lg" id="icon"></i>

                                <p>RULES</p>



                            </li>
                        </div>
                        <div class="t1">
                            <li data-list="tab_4" class="list">

                                <i class="far fa-copy fa-lg" id="icon"></i>

                                <p>EVALUATION</p>

                            </li>
                        </div>
                        <div class="t1">
                            <li data-list="tab_5" class="list">

                                <i class="fas fa-trophy fa-lg" id="icon"></i>

                                <p>PRIZE</p>

                            </li>
                        </div>
                        <div class="t1">

                            <li data-list="tab_6" class="list">

                                <i class="fas fa-database fa-lg" id="icon"></i>

                                <p>DATA</p>

                            </li>

                        </div>
                        <div class="t1">
                            <a href="{% url 'Competion:detail-chapter' competion.pk %}">
                                <input type="button" value="Participate" class="btn-grad">
                            </a>
                        </div>
                    </ul>

                    <br>

                    <div class="abc">
                        <center>
                            <a href="{% url 'Competion:detail-chapter' competion.pk %}"
                                style="margin-top: auto; margin-bottom: auto;">
                                <input type="button" value="Participate" class="btn-participate"><br>
                            </a>
                        </center>
                    </div>

                    <div class="compdiv limiter">
                        <div class="tab_content tab_1"> {{competion.overview | safe}}</div>

                        <div class="tab_content tab_2">{{competion.challenge | safe}}</div>

                        <div class="tab_content tab_3">{{competion.rules | safe}}</div>

                        <div class="tab_content tab_4">{{competion.evaluation | safe}}</div>

                        <div class="tab_content tab_5">{{competion.prize | safe}}</div>

                        <div class="tab_content tab_6" style="font-family: Roboto;">
                            
                            {% if request.user.is_authenticated %}
                                <form method="POST" action="{% url 'Competion:user-submissions' competion.id %}" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="drag-area" style="height: 350px;">
                                        <div class="icon"><i class="fas fa-cloud-upload-alt fa-sm"></i></div>
                                        <br><br>
                                        <header  class="drag">Drag & Drop to Upload File</header>
                                        <span class="drag">OR</span>
                                        <button type="button" class="drag drag-button" style="font-family: inherit;">Browse File</button>
                                        <input type="file" hidden name="user_file" accept=".csv" required>
                                    </div>
                                    <br>
                                    <center><button type="submit" class="drag-button" style="font-family: inherit;">Submit</button></center> 
                                </form>
                                    {% if latest_sub %}
                                    <hr>
                                    <div style="margin-top: 1.5rem;">
                                        <div class="sub-table-wrapper">
                                            <table class="sub-table">
                                                <thead class="sub-thead">
                                                    <tr class="sub-tr">
                                                        <th class="sub-th" scope="col" style="text-align: left;">Name</th>
                                                        <th class="sub-th" scope="col">Latest Score</th>
                                                        <th class="sub-th" scope="col">Best Score</th>
                                                        <th class="sub-th" scope="col">Latest Submission Date</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="sub-tbody">
                                                    <tr class="sub-tr">
                                                        <td class="sub-td" style="text-align: left;">{{ latest_sub.user.get_full_name }}</td>
                                                        <td class="sub-td">{{ latest_sub.score }}</td>
                                                        <td class="sub-td">{{ best_sub.score }}</td>
                                                        <td class="sub-td">{{ latest_sub.submission_date|date:"d M Y H:i:s" }}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    {% endif %}
                            {% else %}
                                <div class="drag-area" style="display: none;">
                                    <button></button>
                                    <input type="file" hidden>
                                </div>
                                <p>Please <a href="{% url 'user:login' %}">login</a> to view data or submit answers.</p>
                            {% endif %}
                            <!-- {#<div class="submissions">
                                <div class="sub-table-wrapper">
                                    <table class="sub-table">
                                        <thead class="sub-thead">
                                            <tr class="sub-tr">
                                                <th class="sub-th" scope="col" style="text-align: left;">Name</th>
                                                <th class="sub-th" scope="col">Rank</th>
                                                <th class="sub-th" scope="col">Best Score</th>
                                                <th class="sub-th" scope="col">Latest Submission</th>
                                            </tr>
                                        </thead>
                                        <tbody class="sub-tbody">
                                            {% for submission in submissions %}
                                            <tr class="sub-tr">
                                                <td class="sub-td" style="text-align: left;">{{ submission.user.get_full_name }}</td>
                                                <td class="sub-td">{{ forloop.counter }}</td>
                                                <td class="sub-td">{{ submission.score }}</td>
                                                <td class="sub-td">{{ submission.submission_date|date:"d M Y H:i:s" }}</td>
                                            </tr>
                                            {% empty %}
                                            <div class="no-record">No submissions found.</div>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>#} -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}





{% block script %}



<script>
const dropArea = document.querySelector(".drag-area"),
dragText = dropArea.querySelector("header"),
button = dropArea.querySelector("button"),
input = dropArea.querySelector("input");
let file; //this is a global variable and we'll use it inside multiple functions
button.onclick = ()=>{
  input.click(); //if user click on the button then the input also clicked
}
input.addEventListener("change", function(){
  //getting user select file and [0] this means if user select multiple files then we'll select only the first one
  file = this.files[0];
  dropArea.classList.add("active");
//   showFile(); //calling function
});
//If user Drag File Over DropArea
dropArea.addEventListener("dragover", (event)=>{
  event.preventDefault(); //preventing from default behaviour
  dropArea.classList.add("active");
  dragText.textContent = "Release to Upload File";
});
//If user leave dragged File from DropArea
dropArea.addEventListener("dragleave", ()=>{
  dropArea.classList.remove("active");
  dragText.textContent = "Drag & Drop to Upload File";
});
//If user drop File on DropArea
dropArea.addEventListener("drop", (event)=>{
  event.preventDefault(); //preventing from default behaviour
  //getting user select file and [0] this means if user select multiple files then we'll select only the first one
  file = event.dataTransfer.files[0];
  input.files = event.dataTransfer.files;
  console.log(input, input.files)
  showFile(); //calling function
});
// function showFile(){
//   let fileType = file.type; //getting selected file type
//   let validExtensions = ["image/jpeg", "image/jpg", "image/png"]; //adding some valid image extensions in array
//   if(validExtensions.includes(fileType)){ //if user selected file is an image file
//     let fileReader = new FileReader(); //creating new FileReader object
//     fileReader.onload = ()=>{
//       let fileURL = fileReader.result; //passing user file source in fileURL variable
//         // UNCOMMENT THIS BELOW LINE. I GOT AN ERROR WHILE UPLOADING THIS POST SO I COMMENTED IT
//        let imgTag = `<img src="${fileURL}" alt="image">`; //creating an img tag and passing user selected file source inside src attribute
//       dropArea.innerHTML = imgTag; //adding that created img tag inside dropArea container
//     }
//     fileReader.readAsDataURL(file);
//   }else{
//     alert("This is not an Image File!");
//     dropArea.classList.remove("active");
//     dragText.textContent = "Drag & Drop to Upload File";
//   }
// }
function showFile(){
  let fileType = file.type; //getting selected file type
  console.log(fileType)
  let validExtensions = ["application/vnd.ms-excel", "text/csv"]; //adding some valid image extensions in array
  if(validExtensions.includes(fileType)){ //if user selected file is an image file
    let fileReader = new FileReader(); //creating new FileReader object
    dragText.textContent = "You can submit your file now.";
    fileReader.onload = ()=>{
    //   let fileURL = fileReader.result; //passing user file source in fileURL variable
    //    let imgTag = `<img src="${fileURL}" alt="image">`; //creating an img tag and passing user selected file source inside src attribute
    //   dropArea.innerHTML = imgTag; //adding that created img tag inside dropArea container
    }
    // fileReader.readAsDataURL(file);
  }else{
    alert("This is not a csv file!");
    dropArea.classList.remove("active");
    dragText.textContent = "Drag & Drop to Upload File";
  }
}

    $(document).ready(function () {

        $(".tab_content").hide()

        $('.tab_content:first-child').show()



        $("ul li").click(function () {

            $("ul li").removeClass("activee")

            $(this).addClass("activee");





            var current_tab = $(this).attr("data-list");

            $(".tab_content").hide();

            $("." + current_tab).show();

        });

    });
    // PROGRESS BAR JAVASCRIPT START
    $(document).ready(function () {

        var countDownDate = new Date("{{competion.end.isoformat}} 23:59:59").getTime();
        var startDate = new Date("{{competion.start.isoformat}} 00:00:00").getTime();
        // Update the count down every 1 second
        // Get todays date and time
        var now = new Date().getTime();

        // Find the distance between now and the count down date
        var distanceWhole = countDownDate - startDate;
        var distanceLeft = countDownDate - now;

        // Time calculations for minutes and percentage progressed
        var minutesLeft = Math.floor(distanceLeft / (1000 * 60));
        var minutesTotal = Math.floor(distanceWhole / (1000 * 60));
        var progress = Math.floor(((minutesTotal - minutesLeft) / minutesTotal) * 100);
        if (progress >= 100) {
            progress = 100;
        }
        $('#progressbar').attr('aria-valuenow', progress).css('width', progress + "%");
        document.getElementById('para').innerHTML = progress * 1 + '%';

        let diffInMilliSeconds = Math.floor(countDownDate - now) / 1000;

        if (diffInMilliSeconds <= 0) {
            document.getElementById("days").innerHTML = 0;
            // document.getElementById("hours").innerHTML = 0;
            // document.getElementById("min").innerHTML = 0;

        }
        else {
            // calculate days

            const days = Math.floor(diffInMilliSeconds / 86400);

            diffInMilliSeconds -= days * 86400;



            document.getElementById("days").innerHTML = days;


            // // calculate hours

            // const hours = Math.floor(diffInMilliSeconds / 3600) % 24;

            // diffInMilliSeconds -= hours * 3600;

            // document.getElementById("hours").innerHTML = hours;



            // // calculate minutes

            // const minutes = Math.floor(diffInMilliSeconds / 60) % 60;

            // diffInMilliSeconds -= minutes * 60;

            // document.getElementById("min").innerHTML = minutes;
        }

        //PROGRESS BAR JAVASCRIPT END



    });



</script>



{% endblock %}